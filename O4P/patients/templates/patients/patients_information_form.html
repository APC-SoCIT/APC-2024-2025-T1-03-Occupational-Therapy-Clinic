{% extends 'base.html' %}

{% block content %}
<h2>{{ title }}</h2>
<form method="post">
    {% csrf_token %}
    
    {{ form.as_p }}
    
    <button type="submit" class="btn btn-primary">Create Patient Record</button>
    <a href="{% url 'patients.list' %}" class="btn btn-secondary">Cancel</a>
</form>

<script>
    document.getElementById('id_province').addEventListener('change', function() {
        console.log("HELLO THERE");
        const provinceCode = this.value;
        const municipalitySelect = document.getElementById('id_municipality');
    
        municipalitySelect.innerHTML = '<option value="">---------</option>'; 
    
        if (!provinceCode) return;
    
        fetch(`/get-municipalities/?province_code=${encodeURIComponent(provinceCode)}`)
            .then(response => response.json())
            .then(data => {
                data.municipalities.forEach(municipality => {
                    const option = new Option(municipality.name, municipality.code);
                    municipalitySelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error:', error));
    });
</script>
{% endblock %}